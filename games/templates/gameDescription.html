{% extends 'layout.html' %}
{% block title %}{{ game.title }}{% endblock %}
{% block content %}
    <div class="description">
        <h2>{{ game.title }}</h2>
        <img src="{{ game.image_url }}" alt="game image">
        <p><span class="headyThing">Price:</span> ${{ game.price }}</p>
        <p><span class="headyThing">Publisher:</span> {{ game.publisher.publisher_name }}</p>
        <p><span class="headyThing">Release Date:</span> {{ game.release_date }}</p>

        <p><span class="headyThing">User Rating Average:</span>
            {% for _ in range(1, 6) %}
                {% if _ <= average_rating|round %}
                    <i class="fas fa-star checked"></i>
                {% else %}
                    <i class="fas fa-star"></i>
                {% endif %}
            {% endfor %}
            ({{ average_rating|round(1) }})
        </p>

        <div class="tags" style="width: calc(800px - 460px);">
            <div class="headyThing">Genres:</div>
            {% for genre in game.genres %}
                <a href="{{ url_for('library_bp.games_by_genre', genre_name=genre.genre_name, page=1) }}">
                    <div class="tag"> {{ genre.genre_name }}</div>
                </a>
            {% endfor %}
        </div>

        <div class="check">
            {% for wishlist_id in wishlist_game_ids %}
                <p>{{ wishlist_id }}</p>
            {% endfor %}
        </div>

        <p><span class="headyThing">About:</span> {{ game.description }}</p>

        <div class="tags">
            <div class="headyThing">Platforms:</div>
            {% if game.supports_linux %} <div class="tag">üêß Linux</div> {% endif %}
            {% if game.supports_windows %} <div class="tag">ü™ü Windows</div> {% endif %}
            {% if game.supports_mac %} <div class="tag">üçé Mac</div> {% endif %}
        </div>

        <div class="user-features">
            {% if game.game_id not in wishlist_game_ids %}
                <form action="{{ url_for('wishlist_bp.wishlist_add') }}" method="post">
                    <input type="hidden" name="game_id" value="{{ game.game_id }}">
                    <button type="submit" class="add-to-wishlist">
                        <img src="{{ url_for('static', filename='heart-icon.svg') }}" class="heartIcon" alt="heart-icon">
                        Add to Wishlist
                    </button>
                </form>
            {% else %}
                <form action="{{ url_for('wishlist_bp.wishlist_remove') }}" method="post">
                    <input type="hidden" name="game_id" value="{{ game.game_id }}">
                    <button type="submit" class="remove-from-wishlist">
                        <img src="{{ url_for('static', filename='heartbreak-icon.svg') }}" class="heartbreakIcon" alt="heartbreak-icon">
                        Remove from Wishlist
                    </button>
                </form>
            {% endif %}
        </div>

        <div class="reviews-section">
        <h3>Critic Reviews:</h3>
        <h3>User Reviews({{ reviews|length }}):</h3>
        <a href="{{ url_for('reviews_bp.write_review', game_id=game.game_id) }}">Write a Review</a>

        {% if reviews %}
            {% for review in reviews %}
                <div class="review">
                    <p><strong>{{ review.user.username_for_ui }}</strong></p>

                    <!-- Display rating as stars -->
                    <div class="star-rating read-only">
                        {% for star_num in range(5, 0, -1) %}
                            {% if review.rating >= star_num %}
                                <label class="active">&#9733;</label>
                            {% else %}
                                <label>&#9733;</label>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <p>{{ review.comment }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>No reviews available.</p>
        {% endif %}
    </div>


    </div>
{% endblock %}
